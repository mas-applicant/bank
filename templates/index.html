
<!DOCTYPE HTML>
<html>
 <head>
  <meta charset="utf-8">
  <title>Тег SELECT</title>

<script type="text/javascript">
  function f1() {
    sender = document.getElementById('sender').value;
    receivers = document.getElementById('receivers').value;
    sum = document.getElementById('sum').value;
    params = 'sender='+sender+'&receivers='+receivers+'&sum='+sum;
// 1. Создаём новый объект XMLHttpRequest
var xhr = new XMLHttpRequest();

// 2. Конфигурируем его: GET-запрос на URL 'phones.json'
xhr.open('POST', 'transmit/', true);

xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");

// http.onreadystatechange = function() {//Call a function when the state changes.
//     if(http.readyState == 4 && http.status == 200) {
//         alert(http.responseText);
//     }
// }

xhr.onload = function () {
        // do something to response
        // console.log(this.responseText);
        j = JSON.parse(this.responseText);
            if (j.code == 0 ){
                color = 'green';
            } else {
                color = 'red';
            };
            message = '<font color="'+color+'">'+j.message+'</font>';
        document.getElementById('welcome').innerHTML = message;
};

// 3. Отсылаем запрос
xhr.send(params);

// // 4. Если код ответа сервера не 200, то это ошибка
// if (xhr.status != 200) {
//   // обработать ошибку
//   alert( xhr.status + ': ' + xhr.statusText ); // пример вывода: 404: Not Found
// } else {
//   // вывести результат
//     j = JSON.parse(xhr.responseText)
//   alert( j.message ); // responseText -- текст ответа.
// }
  }


  function popup() {
   // document.getElementById('welcome').innerHTML = 'Добро пожаловать!';
   // sender = document.getElementById('sender').value;
   // document.getElementById('welcome').innerHTML = sender;
   // sender = document.getElementById('sender').value;
   // document.getElementById('welcome').innerHTML = sender;
  };
  function transmit() {
   f1();
  };
</script>

 </head>
 <body onload="popup()"> 
  <div id="welcome"></div>
 
  <form action="" method="post">
   {% csrf_token %}
   <p><b>Ваше имя:</b><br>
   <p><select size="1" id="sender">
{% for guid, name in users %}
    <option value="{{guid}}">{{name}}</option>
{% endfor %}
   </select></p>
   <p><b>Ваше имя:</b><br>
   <input type="text" size="40" id="receivers" value="65 546">
   <p><b>Ваше имя:</b><br>
   <input type="text" size="40" id="sum" value="6448">
   <p><input type="button" value="Отправить" onclick="transmit()"></p>
  </form>

 </body>
</html>
